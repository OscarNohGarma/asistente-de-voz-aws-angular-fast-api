<!-- Header superior como en enfermería -->
<app-header [nombreUsuario]="nombreUsuario" (cerrarSesion)="handleLogout()"></app-header>

<!-- Navegación por pestañas -->
<div class="container">

  <div class="tabs">
    <button [class.active]="tab === 'solicitudes'" (click)="tab = 'solicitudes'">Solicitudes</button>
    <button [class.active]="tab === 'pacientes'" (click)="tab = 'pacientes'">Pacientes dados de alta</button>
  </div>

  <!-- Contenido por pestañas -->
  <div *ngIf="tab === 'solicitudes'" class="contenido-solicitudes">
    <!-- Columna izquierda: Alertas escaladas -->
    <h3 class="encabezado">Alertas Escaladas</h3>
    <div class="columnas">
      <div class="columna-izquierda">
        <div class="lista-alertas">
          <div *ngFor="let alerta of listaAlertas" (click)="seleccionarAlerta(alerta)"
            [class.seleccionado]="alerta === alertaSeleccionada">
            <p class="nombre-paciente"> {{ alerta.paciente?.nombre_completo }}</p>
            <p>Habitación {{ alerta.paciente?.habitacion }}</p>
            <p>{{formatearAlerta(alerta.fecha!) }} </p>
            {{ validarTipoAlerta( alerta.tipo!) }}
            <p>Situación: {{filtrarAlerta(alerta)}}</p>
          </div>
        </div>
      </div>
      <!-- Columna derecha: Historial de solicitudes del paciente -->
      <div class="columna-derecha" *ngIf="alertaSeleccionada">
        <h3>Historial de solicitudes - {{ alertaSeleccionada.nombre }}</h3>
        <ul>
          <li *ngFor="let solicitud of alertaSeleccionada.historial">
            {{ solicitud.fecha }} - {{ solicitud.descripcion }}
          </li>
        </ul>
      </div>
    </div>

  </div>

  <!-- TAB: Pacientes dados de alta -->
  <div *ngIf="tab === 'pacientes'" class="contenido-pacientes">
    <div class="encabezado">
      <h3>Pacientes dados de alta</h3>
      <button (click)="darAltaNuevoPaciente()">+ Nuevo paciente</button>
    </div>

    <ul class=" lista-pacientes">
      <li *ngFor="let paciente of listaPacientes" class="paciente" (click)="seleccionarPaciente(paciente)"
        [class.seleccionado]="paciente === pacienteSeleccionado">
        <span> {{ paciente.nombre_completo }} </span>- Edad: <span> {{ paciente.edad }} </span>- Habitación: <span>
          {{
          paciente.habitacion }}</span>
      </li>
    </ul>

    <div class="columnas" *ngIf="pacienteSeleccionado">
      <div class="columna-izquierda">
        <h3>Información del paciente </h3>
        <div class="foto">
          <img [src]="getPacienteFotoUrl(pacienteSeleccionado.foto_url)" alt="Foto paciente">
        </div>
        <p>Nombre: {{ pacienteSeleccionado.nombre_completo }}</p>
        <p>Edad: {{ pacienteSeleccionado.edad }}</p>
        <p>Habitación: {{ pacienteSeleccionado.habitacion }}</p>
        <p>Diagnóstico: {{ pacienteSeleccionado.diagnostico }}</p>
        <p>Fecha de ingreso: {{ formatearFecha(pacienteSeleccionado.fecha_ingreso ) }}</p>
        <p>Correo de familiar: {{ pacienteSeleccionado.correo_familiar }}</p>
        <p>Número de familiar: {{ pacienteSeleccionado.telefono_familiar }}</p>

      </div>
      <div class="columna-derecha">
        <h3>Historial del paciente </h3>
        <ul class=" lista-bitacora">
          <li *ngFor="let bitacora of bitacorasFiltradas" class="bitacora">
            <p *ngIf="bitacora.accion === 'solicitud'">
              El(la) paciente {{bitacora.alerta?.paciente.nombre_completo}} realizó una solicitud el
              <span>{{formatearFecha(bitacora.fecha_accion)}}</span> . Las palabras utilizadas fueron:
              <span>{{bitacora.alerta?.palabras_clave}}</span>
            </p>
            <p *ngIf="bitacora.accion === 'atendido-enfermero'">
              El(la) paciente {{bitacora.alerta?.paciente.nombre_completo}} fue atendido el
              <span>{{formatearFecha(bitacora.fecha_accion)}}</span> por el(la) enfermero(a)
              <span>{{bitacora.usuario}}</span>. {{bitacora.descripcion}}
            </p>
            <p *ngIf="bitacora.accion === 'escalado'">
              El(la) paciente {{bitacora.alerta?.paciente.nombre_completo}} fue escalado al médico el
              <span>{{formatearFecha(bitacora.fecha_accion)}}</span> por el(la) enfermero(a)
              <span>{{bitacora.usuario}}</span>. {{bitacora.descripcion}}
            </p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>